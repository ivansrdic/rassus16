<!DOCTYPE html>
<html>
<head>
	<link rel='shortcut icon' href='favicon.ico' />
	<title>Test 2</title>
</head>
<body>
	<div class="container">
		<div class="col-sm-12">
			<ul id="list" class="list-group">

			</ul>	
		</div>
		<p>New query</p>
		<textarea id="query"></textarea>
		<button id="submit" onclick="send()">Send</button>
	</div>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
	var list = document.getElementById("list");

	var webSocket = new WebSocket("ws://" + location.hostname + ":4567/stream/");
	webSocket.onopen = function () {
		webSocket.send(getCookie("requestToken"));
	};
	webSocket.onmessage = function (msg) {
		var listElement = document.createElement("LI");
		listElement.className = "list-group-item";
		listElement.appendChild(document.createTextNode(msg.data));
		list.appendChild(listElement);
		console.log(msg);
	};
	webSocket.onclose = function () { alert("WebSocket connection closed") };

function getCookie(name) {
	var value = "; " + document.cookie;
	var parts = value.split("; " + name + "=");
	if (parts.length == 2) return parts.pop().split(";").shift();
}

function send(){
	var text = document.getElementById("query").value;
	if(text!=''){
		console.log("sending text");
		webSocket.send(text);
		document.getElementById("query").value='';
	}
}
</script>
</html>